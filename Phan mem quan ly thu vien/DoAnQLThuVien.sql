CREATE DATABASE QUANLYTHUVIEN_DOAN_NET
USE QUANLYTHUVIEN_DOAN_NET
GO
SET DATEFORMAT DMY

---CHỨC VỤ
CREATE TABLE CHUCVU
(
	MACV INT IDENTITY(1,1) PRIMARY KEY,
	TENCV NVARCHAR(100)
)



---NHÂN VIÊN
CREATE TABLE NHANVIEN
(
	MANV NVARCHAR(10) PRIMARY KEY,
	HOTEN NVARCHAR(100),
	DIACHI NVARCHAR(300),
	GIOITINH NVARCHAR(10),
	NGAYSINH DATE,
	SDT NVARCHAR(12),
	NGAYVAOLAM DATE,
	HINH NVARCHAR(300),
	MACV INT
)

---LOẠI TÀI KHOẢN
CREATE TABLE LOAITAIKHOAN
(
	MALOAI INT IDENTITY(1,1) PRIMARY KEY,
	TENLOAI NVARCHAR(100),
	MACV INT
)

---TÀI KHOẢN
CREATE TABLE TAIKHOAN
(
	MATK NVARCHAR(10) PRIMARY KEY,
	TENDN NVARCHAR(100),
	MATKHAU NVARCHAR(100),
	MALOAI INT,
	MANV NVARCHAR(10)
)

---CHỦ ĐỀ
CREATE TABLE LOAISACH
(
	MALS NVARCHAR(10) PRIMARY KEY,
	TENLOAI NVARCHAR(100)
)

---NHÀ XUẤT BẢN
CREATE TABLE NHAXUATBAN
(
	MANXB NVARCHAR(10) PRIMARY KEY,
	TENNXB NVARCHAR(100),
	DIACHI NVARCHAR(300),
	DIENTHOAI NVARCHAR(12)
)

---SÁCH
CREATE TABLE SACH
(
	MASACH NVARCHAR(10) PRIMARY KEY,
	TENSACH NVARCHAR(100),
	MANXB NVARCHAR(10),
	MALS NVARCHAR(10),
	SOLUONG INT,	--- SỐ LƯỢNG SÁCH HIỆN CÓ TRONG THƯ VIỆN
	DONGIA FLOAT,
	HINH NVARCHAR(300)
)

---ĐỌC GIẢ
CREATE TABLE DOCGIA
(
	MADG NVARCHAR(10) PRIMARY KEY,
	HOTEN NVARCHAR(100),
	DIACHI NVARCHAR(300),
	GIOITINH NVARCHAR(10),
	NGAYSINH DATE,
	SDT NVARCHAR(12),
	HINH NVARCHAR(300)
)

---MƯỢN SÁCH
CREATE TABLE PHIEUMUONSACH
(
	MAMUON NVARCHAR(10),
	MADG NVARCHAR(10),	
	TINHTRANG NVARCHAR(300),
	TIENPHAT FLOAT
	PRIMARY KEY (MAMUON)
)

CREATE TABLE CHITIETMUONSACH
(
	MAMUON NVARCHAR(10),
	MASACH NVARCHAR(10),
	NGAYMUON DATE,
	NGAYSETRA DATE,
	PRIMARY KEY(MAMUON, MASACH)
)

---TRẢ SÁCH
CREATE TABLE TRASACH
(
	MAMUON NVARCHAR(10),
	MASACH NVARCHAR(10),	
	NGAYTRA DATE,
	PRIMARY KEY(MAMUON, MASACH)
)

---LƯƠNG
CREATE TABLE LUONG
(
	MAPHAT NVARCHAR(10),
	MANV NVARCHAR(10),
	NGAYPHAT DATE,
	LUONGDM INT,
	SONGAYLAM INT,
	LUONG INT,
	PRIMARY KEY(MAPHAT)
)


select * from LOAISACH

--- THIẾT LẬP KHÓA NGOẠI
ALTER TABLE TAIKHOAN
	ADD CONSTRAINT FK_TK_MALOAI FOREIGN KEY(MALOAI) REFERENCES LOAITAIKHOAN(MALOAI)
ALTER TABLE TAIKHOAN
	ADD CONSTRAINT FK_TK_NV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)

ALTER TABLE LOAITAIKHOAN
	ADD CONSTRAINT FK_LTK_CV FOREIGN KEY(MACV) REFERENCES CHUCVU(MACV)

ALTER TABLE NHANVIEN
	ADD CONSTRAINT FK_NV_CV FOREIGN KEY(MACV) REFERENCES CHUCVU(MACV)

ALTER TABLE SACH
	ADD CONSTRAINT FK_S_MALS FOREIGN KEY (MALS) REFERENCES LOAISACH(MALS)
ALTER TABLE SACH
	ADD CONSTRAINT FK_S_MANXB FOREIGN KEY (MANXB) REFERENCES NHAXUATBAN(MANXB)

ALTER TABLE PHIEUMUONSACH
	ADD CONSTRAINT FK_MS_MADG FOREIGN KEY (MADG) REFERENCES DOCGIA(MADG)

ALTER TABLE CHITIETMUONSACH
	ADD CONSTRAINT FK_S_MS FOREIGN KEY (MASACH) REFERENCES SACH(MASACH)
ALTER TABLE CHITIETMUONSACH
	ADD CONSTRAINT FK_MS_MAMUON FOREIGN KEY (MAMUON) REFERENCES PHIEUMUONSACH(MAMUON)

ALTER TABLE TRASACH
	ADD CONSTRAINT FK_TS_MASACH FOREIGN KEY (MASACH) REFERENCES SACH(MASACH)
ALTER TABLE TRASACH
	ADD CONSTRAINT FK_TS_MAMUON FOREIGN KEY (MAMUON) REFERENCES PHIEUMUONSACH(MAMUON)
ALTER TABLE TRASACH
	ADD CONSTRAINT FK_MAMUON_MASACH FOREIGN KEY (MAMUON,MASACH) REFERENCES CHITIETMUONSACH(MAMUON,MASACH)

ALTER TABLE LUONG
	ADD CONSTRAINT FK_LUONG_NV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)

-- NHẬP DỮ LIỆU
-----NHẬP DỮ LIỆU CHO BẢNG CHỨC VỤ
INSERT INTO CHUCVU VALUES (N'Nhân viên')
INSERT INTO CHUCVU VALUES (N'Quản lý')

-----NHẬP DỮ LIỆU CHO BẢNG NHÂN VIÊN
SET DATEFORMAT DMY
INSERT INTO NHANVIEN VALUES ('NV001',N'Nguyễn Văn Cẩn',N'118 Nguyễn Thỉnh Ca, Phường Tân Hiệp, Quận Tân Phú, TP.HCM',N'Nam','18/07/1999','0971558472','25/07/2019','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhNV\HinhNV01.jpg',1)
INSERT INTO NHANVIEN VALUES ('NV002',N'Nguyễn Huy Hoàng',N'257/11 Phan Huy Ích, Phường 11, Quận Gò Vấp, TP.HCM',N'Nam','19/03/1988','077581442','22/06/2007','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhNV\HinhNV02.jpg',2)
INSERT INTO NHANVIEN VALUES ('NV003',N'Phan Văn Hiển',N'356/44 Trần Văn Hớn, Phường Thị Lân, Xã Vĩnh An, Bình Định',N'Nam','21/05/2000','099582114','16/03/2019','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhNV\HinhNV03.jpg',1)
INSERT INTO NHANVIEN VALUES ('NV004',N'Nguyễn Thị Mỹ Tâm',N'11/4 Nguyễn Công Cảnh, Phường Bến Nghe, Quận 1, TP.HCM',N'Nữ','25/08/1991','097554161','13/02/2013','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhNV\HinhNV04.jpg',2)
INSERT INTO NHANVIEN VALUES ('NV005',N'Trần Ý Nhi',N'223 Quốc lộ 1A, Phường Tân Thới Hiệp, Quận 12, TP.HCM',N'Nữ','09/09/1997','076547329','11/01/2018','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhNV\HinhNV05.jpg',1)
INSERT INTO NHANVIEN VALUES ('NV006',N'Nguyễn Đông Danh',N'375 Ca Cao, Phường Bình Long, Xã Tân Phú Trung, Bến Tre',N'Nam','26/06/1994','087562771','26/04/2017','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhNV\HinhNV06.jpg',1)

-----NHẬP DỮ LIỆU CHO BẢNG LOẠI TÀI KHOẢN
INSERT INTO LOAITAIKHOAN VALUES (N'Tài khoản nhân viên', 1)
INSERT INTO LOAITAIKHOAN VALUES (N'Tài khoản quản lý', 2)

-----NHẬP DỮ LIỆU CHO BẢNG TÀI KHOẢN
INSERT INTO TAIKHOAN VALUES('TK001',N'Can123', '123', 1, 'NV001')
INSERT INTO TAIKHOAN VALUES('TK002',N'Hoang123', '456', 2, 'NV002')
INSERT INTO TAIKHOAN VALUES('TK003',N'Hien123', '123', 1, 'NV003')
INSERT INTO TAIKHOAN VALUES('TK004',N'Tam123', '789', 2, 'NV004')
INSERT INTO TAIKHOAN VALUES('TK005',N'Nhi123', '114', 1, 'NV005')
INSERT INTO TAIKHOAN VALUES('TK006',N'Danh123', '513', 1, 'NV006')

select * from TAIKHOAN where MANV = 'NV001'

-----NHẬP DỮ LIỆU CHO BẢNG LOẠI SÁCH
INSERT INTO LOAISACH VALUES ('LS001',N'Công nghệ thông tin')
INSERT INTO LOAISACH VALUES ('LS002',N'Ngoại ngữ')
INSERT INTO LOAISACH VALUES ('LS003',N'Phật Giáo')
INSERT INTO LOAISACH VALUES ('LS004',N'Sách học làm người')
INSERT INTO LOAISACH VALUES ('LS005',N'Văn học nước ngoài')
INSERT INTO LOAISACH VALUES ('LS006',N'Kinh Tế')
INSERT INTO LOAISACH VALUES ('LS007',N'Khoa học Vật lý')
INSERT INTO LOAISACH VALUES ('LS008',N'Khoa học Xã hội')
INSERT INTO LOAISACH VALUES ('LS009',N'Luật')
INSERT INTO LOAISACH VALUES ('LS010',N'Từ điển')
INSERT INTO LOAISACH VALUES ('LS011',N'Lịch sử, địa lý')
INSERT INTO LOAISACH VALUES ('LS012',N'Vật nuôi - Cây cảnh')
INSERT INTO LOAISACH VALUES ('LS013',N'Khoa học kỹ thuật')
INSERT INTO LOAISACH VALUES ('LS014',N'Mỹ thuật')
INSERT INTO LOAISACH VALUES ('LS015',N'Nghệ thuật')
INSERT INTO LOAISACH VALUES ('LS016',N'Âm nhạc')
INSERT INTO LOAISACH VALUES ('LS017',N'Sách giáo khoa')
INSERT INTO LOAISACH VALUES ('LS018',N'Sách tham khảo')
INSERT INTO LOAISACH VALUES ('LS019',N'Danh nhân')
INSERT INTO LOAISACH VALUES ('LS020',N'Tâm lý giáo dục')
INSERT INTO LOAISACH VALUES ('LS021',N'Thể thao - Võ thuật')
INSERT INTO LOAISACH VALUES ('LS022',N'Văn hóa - Xã hội')
INSERT INTO LOAISACH VALUES ('LS023',N'Nữ công gia chánh')
INSERT INTO LOAISACH VALUES ('LS024',N'Nghệ thuật làm đẹp')
INSERT INTO LOAISACH VALUES ('LS025',N'Du lịch')
INSERT INTO LOAISACH VALUES ('LS026',N'Y Học dân tộc VN')

-----NHẬP DỮ LIỆU  CHO BẢNG NHÀ XUẤT BẢN
INSERT INTO NHAXUATBAN VALUES ('NXB001',N'Nhà xuất bản Kim Đồng',N'22/3 Nam Kỳ Khởi Nghĩa, Phường Đa Kao, Quận 1, TP.HCM', N'0988123456')
INSERT INTO NHAXUATBAN VALUES ('NXB002',N'Nhà xuất bản văn học',N'117/34 Trần Thị Mai, Phường Bến Nghé, Quận 1, TP.HCM', N'0977547264')
INSERT INTO NHAXUATBAN VALUES ('NXB003',N'Nhà xuất bản khoa học',N'203/56 Phan Thị Giây, Phường Bình Hưng Hòa, Quận Bình Tân, TP.HCM', N'0776582148')
INSERT INTO NHAXUATBAN VALUES ('NXB004',N'NXB Lao động - Xã hội',N'214/77 TTH07, Phường Tân Thới Hiệp, Quận 12, TP.HCM', N'0989888888')
INSERT INTO NHAXUATBAN VALUES ('NXB005',N'Khoa Học & Kỹ Thuật',N'116/22 Bùi Văn Ngữ, Phường Tân Sơn Nhì, Quận Tân Phú, TP.HCM', N'0903118824')
INSERT INTO NHAXUATBAN VALUES ('NXB006',N'Thanh Niên', N'171/55 Tô Ký, Phường Bình Trị A, Quận Đống Đa, Hà Nội', N'0903118811')
INSERT INTO NHAXUATBAN VALUES ('NXB007',N'NXB Tài Chính', N'203/56 Phường Bình Hưng Hòa, Quận Bình Tân, TP.HCM', N'0903118833')
INSERT INTO NHAXUATBAN VALUES ('NXB008',N'NXB Phụ Nữ', N'203/56 Phường Bình Hưng Hòa, Quận Bình Tân, TP.HCM', N'0989888885')
INSERT INTO NHAXUATBAN VALUES ('NXB009',N'NXB Hồng Đức ', N'203/56 Phường Bình Hưng Hòa, Quận Bình Tân, TP.HCM', N'0989888886')
INSERT INTO NHAXUATBAN VALUES ('NXB010',N'NXB Phương Đông', N'203/56 Phường Bình Hưng Hòa, Quận Bình Tân, TP.HCM', N'0989888889')
INSERT INTO NHAXUATBAN VALUES ('NXB011',N'NXB Thời Đại', N'203/56 Phường Bình Hưng Hòa, Quận Bình Tân, TP.HCM', N'0903118865')
INSERT INTO NHAXUATBAN VALUES ('NXB012',N'NXB Tổng hợp TP.HCM', N'203/56 Phường Bình Hưng Hòa, Quận Bình Tân, TP.HCM', N'0903118878')

-----NHẬP DỮ LIỆU CHO BẢNG SÁCH
INSERT INTO SACH VALUES ('SH001',N'Sketchup & Vray Trong Thiết Kế 1 Kiến Trúc','NXB001','LS002',4,85000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000001.jpg')
INSERT INTO SACH VALUES ('SH002',N'3DS Max-Thủ Thuật Render Phối Cảnh kiến Trúc Ban Ngày Và Đêm Với V-Ray 1.50 RC3','NXB004','LS005',3,75000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000002.jpg')
INSERT INTO SACH VALUES ('SH003',N'Tự Học InDesign CS3','NXB008','LS007',10,55000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000003.jpg')
INSERT INTO SACH VALUES ('SH004',N'Đắc Nhân Tâm - Cuốn Sách Hay Nhất Của Mọi Thời Đại Đưa Bạn Đến Thành Công!','NXB010','LS006',1,60000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000004.jpg')
INSERT INTO SACH VALUES ('SH005',N'Tự Học Photoshop CS5 Qua Hình Ảnh Minh Họa (Sách Kèm CD)','NXB001','LS026',4,62000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000005.jpg')
INSERT INTO SACH VALUES ('SH006',N'180 Thủ Thuật Và Mẹo Hay Trong Flash CS4','NXB007','LS026',4,71000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000006.jpg')
INSERT INTO SACH VALUES ('SH007',N'Microsoft Office 2010 - Dành Cho Người Tự Học','NXB006','LS022',4,18000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000007.jpg')
INSERT INTO SACH VALUES ('SH008',N'Tự học Microsoft Excel 2010','NXB012','LS024',4,37000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000008.jpg')
INSERT INTO SACH VALUES ('SH009',N'C# Dành Cho Người Tự Học - Tập 1','NXB005','LS001',4,69000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000009.jpg')
INSERT INTO SACH VALUES ('SH010',N'C# Dành Cho Người Tự Học - Tập 2','NXB005','LS001',4,67000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000010.jpg')
INSERT INTO SACH VALUES ('SH011',N'Nghệ Thuật Sống An Lạc ','NXB010','LS006',8,69000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000011.jpg')
INSERT INTO SACH VALUES ('SH012',N'Phương Pháp Quản Lý Nhân Sự Trong Công Ty','NXB010','LS002',6,69000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000012.jpg')
INSERT INTO SACH VALUES ('SH013',N'Ngọc Sáng Trong Hoa Sen','NXB011','LS019',7,69000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000013.jpg')
INSERT INTO SACH VALUES ('SH014',N'Hành Trình Về Phương Đông','NXB011','LS021',4,16000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000014.jpg')
INSERT INTO SACH VALUES ('SH015',N'Lập Bản Đồ Tư Duy - Công Cụ Tư Duy Tối Ưu Sẽ Làm Thay Đổi Cuộc Sống Của Bạn','NXB011','LS019',4,17000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000015.jpg')
INSERT INTO SACH VALUES ('SH016',N'Đơn Giản Và Thuần Khiết','NXB001','LS002',4,18000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000016.jpg')
INSERT INTO SACH VALUES ('SH017',N'Cách Sống - Từ Bình Thường Trở Nên Phi Thường','NXB010','LS019',2,19000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000017.jpg')
INSERT INTO SACH VALUES ('SH018',N'Những Quy Luật Mới Trong Bán Lẻ','NXB004','LS005',6,22000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000018.jpg')
INSERT INTO SACH VALUES ('SH019',N'Lavina Và Hầu Tước Elswick (Cuộc Chạy Trốn Nữ Hoàng)','NXB011','LS007',2,75000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000019.jpg')
INSERT INTO SACH VALUES ('SH020',N'Hành Vi Tổ Chức - Organizational Behavior','NXB008','LS007',9,75000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000020.jpg')
INSERT INTO SACH VALUES ('SH021',N'17 Nguyên Tắc Vàng Trong Làm Việc Nhóm','NXB006','LS005',2,75000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000021.jpg')
INSERT INTO SACH VALUES ('SH022',N'Essential Words For The IELTS (Kèm 1 Đĩa CD)','NXB012','LS017',1,77000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000022.jpg')
INSERT INTO SACH VALUES ('SH023',N'Tiếng Hàn Trong Giao Tiếp Hàng Ngày','NXB012','LS016',5,79000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000023.jpg')
INSERT INTO SACH VALUES ('SH024',N'80 Chiêu Thức Kinh Doanh Thành Công','NXB002','LS002',4,86000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000024.jpg')
INSERT INTO SACH VALUES ('SH025',N'Những Công Cụ Thiết Yếu Trong Phân Tích Kỹ Thuật Thị Trường Tài Chính','NXB003','LS005',6,48000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000025.jpg')
INSERT INTO SACH VALUES ('SH026',N'Nàng Lọ Lem Và Đàn Chuột Mất Tích','NXB001','LS014',9,85000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000026.jpg')
INSERT INTO SACH VALUES ('SH027',N'Công Chúa Aurora Và Chú Rồng Nhỏ','NXB011','LS014',3,85000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000027.jpg')
INSERT INTO SACH VALUES ('SH028',N'3ds Max 2009','NXB003','LS006',4,17000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000028.jpg')
INSERT INTO SACH VALUES ('SH029',N'Công Nghệ Mạng Máy Tính','NXB007','LS008',2,720000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000029.jpg')
INSERT INTO SACH VALUES ('SH030',N'Tính Toán Thiết Kế Kết Cấu Với SAP 14','NXB001','LS002',1,63000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000030.jpg')
INSERT INTO SACH VALUES ('SH031',N'Revit Architecture 2011 Từ A Đến Z - Tập 2','NXB001','LS002',5,54000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000031.jpg')
INSERT INTO SACH VALUES ('SH032',N'CoreIDraw X5 - Dành Cho Người Tự Học','NXB005','LS001',4,47000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000032.jpg')
INSERT INTO SACH VALUES ('SH033',N'Chế Bản Điện Tử Với Ilustrator CS5','NXB005','LS001',4,15000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000033.jpg')
INSERT INTO SACH VALUES ('SH034',N'Cẩm Nang Tin Học Văn Phòng','NXB002','LS009',1,71000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000034.jpg')
INSERT INTO SACH VALUES ('SH035',N'Xử Lý Ảnh Photoshop CS5 Dành Cho Người Tự Học - Tập 1','NXB005','LS002',7,72000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000035.jpg')
INSERT INTO SACH VALUES ('SH036',N'71 Kỹ Thuật Thâm Nhập Windows Vista Pro','NXB007','LS003',3,76000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000036.jpg')
INSERT INTO SACH VALUES ('SH037',N'Hướng Dẫn Học Từng Bước Excel 2010 Dành Cho Người Tự Học','NXB002','LS011',2,54000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000037.jpg')
INSERT INTO SACH VALUES ('SH038',N'SQL Server 2005 - Xây Dựng Ứng Dụng Quản Lý Kế Toán Bằng C# 2005','NXB010','LS006',3,57000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000038.jpg')
INSERT INTO SACH VALUES ('SH039',N'Lập Trình Web Bằng ASP.Net Với Macromedia Dreamweaver MX - Tập 2','NXB011','LS013',2,69000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000039.jpg')
INSERT INTO SACH VALUES ('SH040',N'Tạo Website Hướng Database Bằng PHP Và MYSQL - Tập 2','NXB001','LS002',4,27000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000040.jpg')
INSERT INTO SACH VALUES ('SH041',N'Tạo Bản Thuyết Trình Trong Microsoft Office PowerPoint 2007 For Windows','NXB012','LS026',8,35000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000041.jpg')
INSERT INTO SACH VALUES ('SH042',N'Shambhala - Vùng Đất Tây Tạng Huyền Bí Hay Cuộc Hành Trình Tìm Về Bản Thể','NXB012','LS021',3,85000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000042.jpg')
INSERT INTO SACH VALUES ('SH043',N'Sức Mạnh Của Đạo Phật - Để Sống Tốt Hơn Trong Thế Giới Ngày Nay','NXB012','LS022',10,78000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000043.jpg')
INSERT INTO SACH VALUES ('SH044',N'Điều Trị Bệnh Tận Gốc - Năng Lực Của Tâm Bi Mẫn','NXB010','LS005',4,32000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000044.jpg')
INSERT INTO SACH VALUES ('SH045',N'Nhập Môn Windows Vista Tập 1','NXB003','LS021',2,31000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000045.jpg')
INSERT INTO SACH VALUES ('SH046',N'Hành Trình Tâm Linh Siêu Việt','NXB004','LS024',2,32000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000046.jpg')
INSERT INTO SACH VALUES ('SH047',N'Nghiệp Lực - Nhìn Lại Quá Khứ & Nhận Biết Tương Lai','NXB005','LS026',3,42000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000047.jpg')
INSERT INTO SACH VALUES ('SH048',N'Tỉnh Thức','NXB005','LS017',2,42000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000048.jpg')
INSERT INTO SACH VALUES ('SH049',N'13 Nguyên Tắc Nghĩ Giàu, Làm Giàu - Think And Grow Rich','NXB005','LS014',2,54000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000049.jpg')
INSERT INTO SACH VALUES ('SH050',N'Đạo Kỷ Nguyên Mới','NXB006','LS017',1,46000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000050.jpg')
INSERT INTO SACH VALUES ('SH051',N'The Power Of Compassion - Sức mạnh của lòng từ','NXB006','LS018',4,29000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000051.jpg')
INSERT INTO SACH VALUES ('SH052',N'Con Đường Mây Trắng - DER WEG DER WEISSEN WOLKEN','NXB004','LS018',2,81000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000052.jpg')
INSERT INTO SACH VALUES ('SH053',N'Đức Đạt Lai Lạt Ma Tại Harvard','NXB007','LS015',4,77000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000053.jpg')
INSERT INTO SACH VALUES ('SH054',N'Những Con Đường Của Ánh Sáng - Tập 1','NXB009','LS022',4,59000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000054.jpg')
INSERT INTO SACH VALUES ('SH055',N'Những Con Đường Của Ánh Sáng - Tập 2','NXB009','LS012',4,59000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000055.jpg')
INSERT INTO SACH VALUES ('SH056',N'Cái Vô Hạn Trong Lòng Bàn Tay (Từ Big Bang Đến Giác Ngộ)','NXB007','LS006',6,87000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000056.jpg')
INSERT INTO SACH VALUES ('SH057',N'Nghệ Thuật Thiền Định','NXB008','LS005',5,90000,N'E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhSP\000057.jpg')


-----NHẬP DỮ LIỆU CHO BẢNG ĐỌC GIẢ
SET DATEFORMAT DMY
INSERT INTO DOCGIA VALUES ('DG001',N'Nguyễn Hoàng Quý',N'226/15 Kha Vạn Cân, Phường Đông Cao, Quận Thủ Đức, TP.HCM',N'Nam','29/09/2000','0981125876','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhDG\HinhDG01.jpg')
INSERT INTO DOCGIA VALUES ('DG002',N'Nguyễn Văn Bửu',N'113/21 Nguyễn Đình Chiểu, Phường Bến Nghé, Quận 1, TP.HCM',N'Nam','17/08/1999','0775624118','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhDG\HinhDG02.jpg')
INSERT INTO DOCGIA VALUES ('DG003',N'Cao Thị Thơ',N'42/28 Cao Nhữ Lại, Phường Thị Nghè, Huyện Cái Quan, Vũng Tàu',N'Nữ','27/06/2003','0925114763','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhDG\HinhDG03.jpg')
INSERT INTO DOCGIA VALUES ('DG004',N'Nguyễn Văn Liêm',N'116/54 Trần Văn Cao, Phường Đình Hưng, Huyện Cao Cả, TP. Phan Thiết',N'Nam','15/04/1997','0756418692','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhDG\HinhDG04.jpg')
INSERT INTO DOCGIA VALUES ('DG005',N'Hoàng Nhữ Ngọc',N'152A Nguyễn Văn Khối, Phường 11, Quận Gò Vấp, TP.HCM',N'Nữ','26/06/2001','0912568845','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhDG\HinhDG05.jpg')
INSERT INTO DOCGIA VALUES ('DG006',N'Trần Văn Ơn',N'44/6 Lại Thị Thơ, Phường Đa Kao, Quận 1, TP.HCM',N'Nam','30/03/1998','0976443771','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhDG\HinhDG06.jpg')
INSERT INTO DOCGIA VALUES ('DG007',N'Cao Thị Minh',N'11/2 Nguyễn Thị Bích, Phường Tôn Hiển, Huyện La Nghĩa, Bình Thuận',N'Nữ','14/02/2000','0978336411','E:\Cong Nghe .Net\DoAn_QuanLyThuVien\DoAnQuanLyThuVien\HinhAnhDG\HinhDG07.jpg')



-----NHẬP DỮ LIỆU CHO BẢNG MƯỢN SÁCH
INSERT INTO PHIEUMUONSACH VALUES('MS001','DG005',NULL,NULL)
INSERT INTO PHIEUMUONSACH VALUES('MS002','DG004',NULL,NULL)
INSERT INTO PHIEUMUONSACH VALUES('MS003','DG002',NULL,NULL)

-----NHẬP DỮ LIỆU CHO BẢNG CHI TIẾT MƯỢN SÁCH
SET DATEFORMAT DMY
INSERT INTO CHITIETMUONSACH VALUES ('MS001','SH010','29/10/2019','05/11/2019')
INSERT INTO CHITIETMUONSACH VALUES ('MS001','SH007','29/10/2019','05/11/2019')
INSERT INTO CHITIETMUONSACH VALUES ('MS002','SH050','15/07/2019','17/07/2019')
INSERT INTO CHITIETMUONSACH VALUES ('MS003','SH018','25/06/2019','22/07/2019')
INSERT INTO CHITIETMUONSACH VALUES ('MS003','SH004','25/06/2019','25/07/2019')

SELECT distinct * FROM CHITIETMUONSACH
SELECT * FROM PHIEUMUONSACH
SELECT * FROM TRASACH
select * from NHAXUATBAN 
select * from SACH

select Sach.* from SACH, CHITIETMUONSACH where CHITIETMUONSACH.MASACH = SACH.MASACH
select Sach.*, NGAYMUON, NGAYSETRA, HOTEN from SACH, CHITIETMUONSACH, PHIEUMUONSACH, DOCGIA where DOCGIA.MADG = PHIEUMUONSACH.MADG and CHITIETMUONSACH.MAMUON = PHIEUMUONSACH.MAMUON and CHITIETMUONSACH.MASACH = SACH.MASACH and SACH.MASACH in (Select MASACH from CHITIETMUONSACH) and SACH.MASACH not in (Select MASACH from TRASACH) 
select Sach.* from SACH where SACH.MASACH in (Select MASACH from CHITIETMUONSACH) and SACH.MASACH not in (Select MASACH from TRASACH)

-----NHẬP DỮ LIỆU CHO BẢNG TRẢ SÁCH
SET DATEFORMAT DMY
INSERT INTO TRASACH VALUES ('MS001','SH010','05/11/2019')
INSERT INTO TRASACH VALUES ('MS001','SH007','05/11/2019')
INSERT INTO TRASACH VALUES ('MS002','SH050','17/07/2019')
INSERT INTO TRASACH VALUES ('MS003','SH018','22/07/2019')
INSERT INTO TRASACH VALUES ('MS003','SH004','25/07/2019')

insert into TRASACH values ('MS002','SH046','17/07/2019')

SET DATEFORMAT DMY
INSERT INTO LUONG VALUES('PH001','NV001','20/02/2020',150000,27,4050000)
INSERT INTO LUONG VALUES('PH002','NV002','23/02/2020',200000,29,5800000)
INSERT INTO LUONG VALUES('PH003','NV003','19/02/2020',150000,25,3750000)
INSERT INTO LUONG VALUES('PH004','NV004','20/02/2020',200000,30,6000000)
INSERT INTO LUONG VALUES('PH005','NV005','21/02/2020',150000,24,3600000)
INSERT INTO LUONG VALUES('PH006','NV006','25/02/2020',150000,29,4350000)
INSERT INTO LUONG VALUES('PH007','NV001','18/03/2020',150000,23,3450000)

select * from LUONG
-----TRIGGER XÓA NHÂN VIÊN VÀ XÓA LUÔN NHÂN VIÊN TRONG BẢNG TÀI KHOẢN
CREATE TRIGGER XOANHANVIEN
ON NHANVIEN
INSTEAD OF DELETE
AS
BEGIN
	DELETE TAIKHOAN
	WHERE MANV = (SELECT MANV FROM deleted)
	DELETE LUONG
	WHERE MANV = (SELECT MANV FROM deleted)
	DELETE NHANVIEN
	WHERE MANV = (SELECT MANV FROM deleted)
END	

-----TRIGGER XÓA ĐỌC GIẢ VÀ XÓA LUÔN ĐỌC GIẢ TRONG BẢNG PHIẾU MƯỢN SÁCH
CREATE TRIGGER XOADOCGIA
ON DOCGIA
INSTEAD OF DELETE
AS
BEGIN
	DELETE PHIEUMUONSACH
	WHERE MADG = (SELECT MADG FROM deleted)
	DELETE DOCGIA
	WHERE MADG = (SELECT MADG FROM deleted)
END	

-----TRIGGER XÓA PHIẾU MƯỢN SÁCH
CREATE TRIGGER XOAPHIEUMUON
ON PHIEUMUONSACH
INSTEAD OF DELETE
AS
BEGIN
	DELETE CHITIETMUONSACH
	WHERE MAMUON = (SELECT MAMUON FROM deleted)
	DELETE TRASACH
	WHERE MAMUON = (SELECT MAMUON FROM deleted)
	DELETE PHIEUMUONSACH
	WHERE MAMUON = (SELECT MAMUON FROM deleted)
END

-----TRIGGER XÓA SÁCH VÀ THÔNG TIN SÁCH VÀ THÔNG TIN MƯỢN, TRẢ SÁCH
CREATE TRIGGER XOASACH
ON SACH
INSTEAD OF DELETE
AS
BEGIN
	DELETE CHITIETMUONSACH
	WHERE MASACH = (SELECT MASACH FROM deleted)
	DELETE TRASACH
	WHERE MASACH = (SELECT MASACH FROM deleted)
	DELETE SACH
	WHERE MASACH = (SELECT MASACH FROM deleted)
END	

-----TRIGGER CHI TIẾT MƯỢN SÁCH VÀ THÔNG TIN TRONG TRẢ SÁCH
CREATE TRIGGER XOACHITIETMUONSACH
ON CHITIETMUONSACH
INSTEAD OF DELETE
AS
BEGIN	
	DELETE TRASACH
	WHERE MASACH = (SELECT MASACH FROM deleted) AND MAMUON = (SELECT MAMUON FROM deleted)
	DELETE CHITIETMUONSACH
	WHERE MASACH = (SELECT MASACH FROM deleted) AND MAMUON = (SELECT MAMUON FROM deleted)
END	

-----TRIGGER CHECK TUỔI CỦA NHÂN VIÊN
CREATE TRIGGER CHECKTUOINHANVIEN
ON NHANVIEN
FOR INSERT, UPDATE
AS
	DECLARE @NGAYSINH DATE
	SET @NGAYSINH = (SELECT NGAYSINH FROM INSERTED)
	IF(DATEDIFF(YEAR,@NGAYSINH,GETDATE())) <= 18
	BEGIN
		PRINT N'ĐỘ TUỔI CỦA NHÂN VIÊN PHẢI LỚN HƠN 18'
		ROLLBACK TRAN
	END
GO

-----TRIGGER THAY ĐỔI SỐ LƯỢNG KHI THÊM DỮ LIỆU VÀO BẢNG MƯỢN SÁCH
CREATE TRIGGER THAYDOISOLUONGKHITHEMSACH
ON CHITIETMUONSACH
FOR INSERT
AS
BEGIN
	UPDATE SACH
	SET SOLUONG = SOLUONG - 1
	WHERE MASACH = (SELECT MASACH FROM inserted)
END

-----TRIGGER THAY ĐỔI SỐ LƯỢNG KHI THÊM DỮ LIỆU VÀO BẢNG TRẢ SÁCH
CREATE TRIGGER THAYDOISOLUONGKHITRASACH
ON TRASACH
FOR INSERT
AS
BEGIN
	UPDATE SACH
	SET SOLUONG = SOLUONG + 1
	WHERE MASACH = (SELECT MASACH FROM inserted)
END

-----TRIGGER CẬP NHẬT TÌNH TRẠNG CHO MƯỢN SÁCH
CREATE TRIGGER CAPNHATTINHTRANGMUONSACH
ON CHITIETMUONSACH
FOR INSERT
AS
BEGIN
	DECLARE @MAMS NVARCHAR(10)
	SET @MAMS = (SELECT MAMUON FROM inserted)
	UPDATE PHIEUMUONSACH
	SET TINHTRANG = N'Đang mượn'
	WHERE PHIEUMUONSACH.MAMUON = @MAMS
END

-----TRIGGER CẬP NHẬT TÌNH TRẠNG CHO MƯỢN SÁCH KHI XÓA
CREATE TRIGGER CAPNHATTINHTRANGMUONSACHKHIXOA
ON CHITIETMUONSACH
FOR DELETE
AS
BEGIN
	DECLARE @MAMS NVARCHAR(10)
	SET @MAMS = (SELECT MAMUON FROM deleted)
	DECLARE @SLMUON INT
	SET @SLMUON = (SELECT COUNT(*) FROM CHITIETMUONSACH WHERE CHITIETMUONSACH.MAMUON = @MAMS)
	DECLARE @SLTRA INT
	SET @SLTRA = (SELECT COUNT(*) FROM TRASACH WHERE TRASACH.MAMUON = @MAMS)
	IF(@SLTRA = @SLMUON)
	BEGIN
		UPDATE PHIEUMUONSACH
		SET TINHTRANG = N'Đã trả'
		WHERE PHIEUMUONSACH.MAMUON = @MAMS
	END		
	IF(@SLMUON = 0)
	BEGIN
		UPDATE PHIEUMUONSACH
		SET TINHTRANG = NULL
		WHERE PHIEUMUONSACH.MAMUON = @MAMS
	END
	UPDATE SACH
	SET SOLUONG = SOLUONG + 1
	WHERE MASACH = (SELECT MASACH FROM inserted)
END

-----TRIGGER CẬP NHẬT TÌNH TRẠNG CHO MƯỢN SÁCH KHI ĐÃ TRẢ
CREATE TRIGGER CAPNHATTINHTRANGMUONSACHKHITRA
ON TRASACH
FOR INSERT
AS
BEGIN
	DECLARE @MAMS NVARCHAR(10)
	SET @MAMS = (SELECT MAMUON FROM inserted)
	DECLARE @SLMUON INT
	SET @SLMUON = (SELECT COUNT(*) FROM CHITIETMUONSACH WHERE CHITIETMUONSACH.MAMUON = @MAMS)
	DECLARE @SLTRA INT
	SET @SLTRA = (SELECT COUNT(*) FROM TRASACH WHERE TRASACH.MAMUON = @MAMS)
	IF(@SLTRA = @SLMUON)
	BEGIN
		UPDATE PHIEUMUONSACH
		SET TINHTRANG = N'Đã trả'
		WHERE PHIEUMUONSACH.MAMUON = @MAMS
	END	
END

-----TRIGGER CẬP NHẬT TÌNH TRẠNG CHO MƯỢN SÁCH KHI ĐÃ TRẢ
CREATE TRIGGER CAPNHATTINHTRANGMUONSACHKHIXOATRA
ON TRASACH
FOR DELETE
AS
BEGIN
	DECLARE @MAMS NVARCHAR(10)
	SET @MAMS = (SELECT MAMUON FROM deleted)
	DECLARE @SLMUON INT
	SET @SLMUON = (SELECT COUNT(*) FROM CHITIETMUONSACH WHERE CHITIETMUONSACH.MAMUON = @MAMS)
	DECLARE @SLTRA INT
	SET @SLTRA = (SELECT COUNT(*) FROM TRASACH WHERE TRASACH.MAMUON = @MAMS)
	IF(@SLTRA != @SLMUON)
	BEGIN
		UPDATE PHIEUMUONSACH
		SET TINHTRANG = N'Đang mượn'
		WHERE PHIEUMUONSACH.MAMUON = @MAMS
	END
	
END

-----TRIGGER XÓA LOẠI SÁCH VÀ SÁCH CÓ THỂ LOẠI ĐÓ
CREATE TRIGGER XOASACHLOAISACH
ON LOAISACH
INSTEAD OF DELETE
AS
BEGIN
	DELETE SACH
	WHERE MALS = (SELECT MALS FROM deleted)
	DELETE LOAISACH
	WHERE MALS = (SELECT MALS FROM deleted)
END	

-----TRIGGER XÓA LOẠI SÁCH VÀ SÁCH CÓ THỂ LOẠI ĐÓ
CREATE TRIGGER XOASACHNXB
ON NHAXUATBAN
INSTEAD OF DELETE
AS
BEGIN
	DELETE SACH
	WHERE MANXB = (SELECT MANXB FROM deleted)
	DELETE NHAXUATBAN
	WHERE MANXB = (SELECT MANXB FROM deleted)
END	

-----TRIGGER CẬP NHẬT SAU KHI XÓA TRẢ SÁCH
CREATE TRIGGER CAPNHATTINHTRANGMUONSACHKHIXOATRA1
ON TRASACH
FOR DELETE
AS
BEGIN
	UPDATE SACH
	SET SOLUONG = SOLUONG - 1
	WHERE MASACH = (SELECT MASACH FROM inserted)
END

select count(*) from DOCGIA where MADG = 'DG005' and MADG in (select MADG from PHIEUMUONSACH, CHITIETMUONSACH where PHIEUMUONSACH.MAMUON = CHITIETMUONSACH.MAMUON and CHITIETMUONSACH.MAMUON not in (select MAMUON from TRASACH))

select Sach.*, NGAYMUON, NGAYSETRA, HOTEN from SACH, CHITIETMUONSACH, PHIEUMUONSACH, DOCGIA where DOCGIA.MADG = PHIEUMUONSACH.MADG and CHITIETMUONSACH.MAMUON = PHIEUMUONSACH.MAMUON and CHITIETMUONSACH.MASACH = SACH.MASACH and SACH.MASACH in (Select MASACH from CHITIETMUONSACH) and SACH.MASACH in (Select MASACH from TRASACH)

select Count(*) from PHIEUMUONSACH, CHITIETMUONSACH where PHIEUMUONSACH.MAMUON = 'MS001' and PHIEUMUONSACH.MAMUON = CHITIETMUONSACH.MAMUON and CHITIETMUONSACH.MASACH not in (select MASACH from TRASACH where CHITIETMUONSACH.MAMUON = TRASACH.MAMUON)

select Count(*) from CHITIETMUONSACH where CHITIETMUONSACH.MAMUON = 'MS005' and CHITIETMUONSACH.MASACH not in (select MASACH from TRASACH where CHITIETMUONSACH.MAMUON = TRASACH.MAMUON)

select Sach.*, NGAYMUON, NGAYTRA, HOTEN from SACH, CHITIETMUONSACH, PHIEUMUONSACH, DOCGIA, TRASACH where DOCGIA.MADG = PHIEUMUONSACH.MADG and CHITIETMUONSACH.MAMUON = PHIEUMUONSACH.MAMUON and CHITIETMUONSACH.MAMUON = TRASACH.MAMUON and CHITIETMUONSACH.MASACH = TRASACH.MASACH and CHITIETMUONSACH.MASACH = SACH.MASACH and SACH.MASACH in (Select MASACH from CHITIETMUONSACH) and SACH.MASACH in (Select MASACH from TRASACH)

select Sach.*, NGAYMUON, NGAYSETRA, HOTEN from SACH, CHITIETMUONSACH, PHIEUMUONSACH, DOCGIA where DOCGIA.MADG = PHIEUMUONSACH.MADG and CHITIETMUONSACH.MAMUON = PHIEUMUONSACH.MAMUON and CHITIETMUONSACH.MASACH = SACH.MASACH and SACH.MASACH in (Select MASACH from CHITIETMUONSACH) and SACH.MASACH not in (Select MASACH from TRASACH)

